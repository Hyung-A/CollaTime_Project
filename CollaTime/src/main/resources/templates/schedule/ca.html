<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<script>
        // 첫 번째 모달 열기
        function openModal() {
            document.getElementById("emptyModal").style.display = "flex";
        }

        // 첫 번째 모달 닫기
        function closeModal() {
            document.getElementById("emptyModal").style.display = "none";
        }

        // 두 번째 모달 열기
        function openSecondModal() {
            const makescheduleModal = document.getElementById("makescheduleModal");
            if (makescheduleModal) {
                makescheduleModal.style.display = "flex";
                makescheduleModal.style.zIndex = "20";
                makescheduleModal.style.position = "absolute";
                makescheduleModal.style.visibility = "visible";
            }
        }

        // 두 번째 모달 닫기
        function closeSecondModal() {
            const makescheduleModal = document.getElementById("makescheduleModal");
            if (makescheduleModal) {
                makescheduleModal.style.display = "none";
                makescheduleModal.querySelectorAll("input, textarea").forEach(input => {
                    input.value = "";
                });
            }
        }


        // 모든 plusList 버튼을 선택하고, 클릭 시 makescheduleModal 열기 설정
        const plusListButtons = document.querySelectorAll("#plusList");
        const makescheduleModal = document.getElementById("makescheduleModal");

        plusListButtons.forEach(button => {
            button.addEventListener("click", function () {
                makescheduleModal.style.display = "flex"; // makescheduleModal 열기
                makescheduleModal.style.zIndex = "20";    // 위에 표시
            });
        });

        // 두 번째 모달의 X 버튼 클릭 시 두 번째 모달 닫기
        const makeScheduleXButton = document.getElementById("makeScheduleXButton");
        if (makeScheduleXButton) {
            makeScheduleXButton.addEventListener("click", closeSecondModal);
        }

        // 모든 날짜 요소에 첫 번째 모달 열기 이벤트 추가
        document.querySelectorAll('.date').forEach(date => {
            date.addEventListener("click", handleDateClick);
        });

        // 첫 번째 모달의 X 버튼 설정
        const emptyXButton = document.getElementById("emptyXButton");
        if (emptyXButton) {
            emptyXButton.addEventListener("click", closeModal);
        }

        // createSuccess 모달 x 버튼
        document.getElementById("createXButton").addEventListener("click", function () {
            document.getElementById("createsuccessModal").style.display = "none";
            document.getElementById("makescheduleModal").style.display = "none";

        });

        function showCreateSuccessModal() {
            const createsuccessModal = document.getElementById("createsuccessModal");
            if (createsuccessModal) {
                createsuccessModal.style.display = "flex";
            }
        }

        // makescheduleModal에서 스케줄 생성 완료 시 호출
        document.getElementById("makeschedule-confirmButton").addEventListener("click", function () {
            // 스케줄 생성 로직 수행 후 성공 시 showCreateSuccessModal 호출
            makescheduleModal.style.display = "none";   // makescheduleModal 닫기
            showCreateSuccessModal();                 // createSuccess 모달 표시
        });



        function handleDateClick() {
            fetch("/api/schedules/user", { cache: "no-store" })
                .then(response => response.json())
                .then(schedules => {
                    document.getElementById("emptyModal").style.display = "none";
                    document.getElementById("listModal").style.display = "none";

                    if (schedules.length === 0) {
                        document.getElementById("emptyModal").style.display = "flex";
                    } else {
                        document.getElementById("listModal").style.display = "flex";
                        displaySchedules(schedules);
                    }
                })
                .catch(error => console.error("Error fetching schedules:", error));
        }

        function displaySchedules(schedules) {
            const scheduleList = document.getElementById("scheduleList");
            scheduleList.innerHTML = "";
            schedules.forEach(schedule => {
                const item = document.createElement("div");
                item.textContent = `${schedule.scheduleTitle} (${schedule.scheduleStartDate} ~ ${schedule.scheduleEndDate})`;
                scheduleList.appendChild(item);
            });
        }
    });
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>통합된 달력 페이지</title>

    <link rel="stylesheet" href="/css/schedule/calendar.css">
    <link rel="stylesheet" href="/css/schedule/details.css">
    <link rel="stylesheet" href="/css/schedule/delete.css">
    <link rel="stylesheet" href="/css/schedule/modify.css">
    <link rel="stylesheet" href="/css/schedule/makeschedule.css">
    <link rel="stylesheet" href="/css/schedule/deletecheck.css">
</head>

<body>
<div th:include="common/programheader.html"></div>

<!-- 메인 레이아웃 -->
<div class="main-layout">
    <!-- 왼쪽 사이드바 -->
    <div id="leftBarLayout">
        <div id="blueBackground">
            <div id="profile">프로필 사진</div>
            <p id="nickname">사용자 이름</p>
            <p id="mypage">마이페이지</p>1
            <div id="whiteBar1"></div>
            <p id="textMyProject">My Project</p>
            <!-- 추가 프로젝트와 사이드바 내용 여기에 추가 -->
        </div>
    </div>

    <!-- 메인 달력 컨테이너 -->
    <div class="calendar-container">
        <!-- 새로 만든 메인 캘린더 div -->
        <div class="main-calendar">
            <div class="calendar">
                <div class="header">
                    <div class="year-month"></div>
                    <div class="nav">
                        <button class="nav-btn go-prev" onclick="prevMonth()">&lt;</button>
                        <button class="nav-btn go-today" onclick="goToday()">Today</button>
                        <button class="nav-btn go-next" onclick="nextMonth()">&gt;</button>
                    </div>
                </div>
                <div class="main">
                    <div class="days">
                        <div class="day">일</div>
                        <div class="day">월</div>
                        <div class="day">화</div>
                        <div class="day">수</div>
                        <div class="day">목</div>
                        <div class="day">금</div>
                        <div class="day">토</div>
                    </div>
                    <div class="dates"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 모달 창 -->
<div th:include="schedule/empty.html" id="modalContent" style="display: none"></div>
<div th:include="schedule/makeschedule.html" id="makescheduleModal" style="display: none; position:absolute; z-index: 10"></div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        let date = new Date();

        const renderCalender = () => {
            const viewYear = date.getFullYear();
            const viewMonth = date.getMonth();

            document.querySelector('.year-month').textContent = `${viewYear}년 ${viewMonth + 1}월`;

            const prevLast = new Date(viewYear, viewMonth, 0);
            const thisLast = new Date(viewYear, viewMonth + 1, 0);

            const PLDate = prevLast.getDate();
            const PLDay = prevLast.getDay();

            const TLDate = thisLast.getDate();
            const TLDay = thisLast.getDay();

            const prevDates = [];
            const thisDates = [...Array(TLDate + 1).keys()].slice(1);
            const nextDates = [];

            if (PLDay !== 6) {
                for (let i = 0; i < PLDay + 1; i++) {
                    prevDates.unshift(PLDate - i);
                }
            }

            for (let i = 1; i < 7 - TLDay; i++) {
                nextDates.push(i);
            }

            const dates = prevDates.concat(thisDates, nextDates);
            const firstDateIndex = dates.indexOf(1);
            const lastDateIndex = dates.lastIndexOf(TLDate);

            dates.forEach((date, i) => {
                const condition = i >= firstDateIndex && i < lastDateIndex + 1 ? 'this' : 'other';
                dates[i] = `<div class="date"><span class=${condition}>${date}</span></div>`;
            });

            document.querySelector('.dates').innerHTML = dates.join('');

            const today = new Date();
            if (viewMonth === today.getMonth() && viewYear === today.getFullYear()) {
                for (let date of document.querySelectorAll('.this')) {
                    if (+date.innerText === today.getDate()) {
                        date.classList.add('today');
                        break;
                    }
                }
            }
        };

        renderCalender();

        const prevMonth = () => {
            date.setMonth(date.getMonth() - 1);
            renderCalender();
        };

        const nextMonth = () => {
            date.setMonth(date.getMonth() + 1);
            renderCalender();
        };

        const goToday = () => {
            date = new Date();
            renderCalender();
        };

        // 첫 번째 모달 열기
        function openModal() {
            document.getElementById("modalContent").style.display = "flex";
        }

        // 첫 번째 모달 닫기
        function closeModal() {
            document.getElementById("modalContent").style.display = "none";
        }

        // 두 번째 모달 열기
        function openSecondModal() {
            const makescheduleModal = document.getElementById("makescheduleModal");
            if (makescheduleModal) {
                makescheduleModal.style.display = "flex";
                makescheduleModal.style.zIndex = "20";
                makescheduleModal.style.position = "absolute";
                makescheduleModal.style.visibility = "visible";
            }
        }

        // 두 번째 모달 닫기
        function closeSecondModal() {
            const makescheduleModal = document.getElementById("makescheduleModal");
            if (makescheduleModal) {
                makescheduleModal.style.display = "none";
            }
        }

        // 첫 번째 모달의 plusList 버튼 클릭 시 두 번째 모달 열기
        const plusListButton = document.getElementById("plusList");
        if (plusListButton) {
            plusListButton.addEventListener("click", openSecondModal);
        }

        // 두 번째 모달의 X 버튼 클릭 시 두 번째 모달 닫기
        const middleXXButton = document.getElementById("middleXXButton");
        if (middleXXButton) {
            middleXXButton.addEventListener("click", closeSecondModal);
        }

        // 두 번째 모달의 "취소" 버튼 클릭 시 두 번째 모달 닫기
        const cancelButton = document.getElementById("cancelButton");
        if (cancelButton) {
            cancelButton.addEventListener("click", closeSecondModal);
        }

        // 모든 날짜 요소에 첫 번째 모달 열기 이벤트 추가
        document.querySelectorAll('.date').forEach(date => {
            date.addEventListener('click', openModal);
        });

        // 첫 번째 모달의 X 버튼 설정
        const middleXButton = document.getElementById("middleXButton");
        if (middleXButton) {
            middleXButton.addEventListener("click", closeModal);
        }
    });
</script>


</body>
</html>
